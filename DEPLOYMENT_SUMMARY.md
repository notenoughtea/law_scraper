# โ ะะตะฐะปะธะทะพะฒะฐะฝะพ: ะะตะฟะปะพะน ะฝะฐ 77.105.133.231 ะธ CI/CD ัะตัะตะท GitHub

## ๐ฏ ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

ะะฐัััะพะตะฝ ะฟะพะปะฝัะน CI/CD pipeline ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะดะตะฟะปะพั ะฝะฐ ัะตัะฒะตั `77.105.133.231` ัะตัะตะท GitHub Actions.

---

## ๐ฆ ะกะพะทะดะฐะฝะฝัะต ะบะพะผะฟะพะฝะตะฝัั

### 1. GitHub Actions Workflow

**ะคะฐะนะป:** `.github/workflows/deploy.yml`

**ะคัะฝะบัะธะธ:**
- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ ะฟัะธ push ะฒ `main`/`master`
- โ ะะฐะฟััะบ ัะตััะพะฒ ะฟะตัะตะด ะดะตะฟะปะพะตะผ
- โ ะกะฑะพัะบะฐ ะฟัะธะปะพะถะตะฝะธั
- โ ะะพะฟะธัะพะฒะฐะฝะธะต ัะฐะนะปะพะฒ ะฝะฐ ัะตัะฒะตั ะฟะพ SSH
- โ ะะฐะฟััะบ Docker Compose ะฝะฐ ัะตัะฒะตัะต
- โ ะัะพะฒะตัะบะฐ ััะฟะตัะฝะพััะธ ะดะตะฟะปะพั
- โ ะััะฝะพะน ะทะฐะฟััะบ ัะตัะตะท GitHub UI

### 2. ะกะบัะธะฟัั ะดะตะฟะปะพั

| ะกะบัะธะฟั | ะะฐะทะฝะฐัะตะฝะธะต |
|--------|-----------|
| `deployment/scripts/setup-server.sh` | ะะตัะฒะพะฝะฐัะฐะปัะฝะฐั ะฝะฐัััะพะนะบะฐ ัะตัะฒะตัะฐ (Docker, Docker Compose) |
| `deployment/scripts/deploy.sh` | ะะตะฟะปะพะน ะฟัะธะปะพะถะตะฝะธั ะฝะฐ ัะตัะฒะตั |
| `deployment/scripts/status.sh` | ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะฟัะธะปะพะถะตะฝะธั |
| `deployment/scripts/logs.sh` | ะัะพัะผะพัั ะปะพะณะพะฒ ั ัะตัะฒะตัะฐ |
| `deployment/scripts/restart.sh` | ะะตัะตะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั |

ะัะต ัะบัะธะฟัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะตะปะฐัั chmod +x ะฟัะธ ะทะฐะฟััะบะต ัะตัะตะท Makefile.

### 3. Makefile ะบะพะผะฐะฝะดั

```bash
# ะะตะฟะปะพะน
make setup-server      # ะะตัะฒะพะฝะฐัะฐะปัะฝะฐั ะฝะฐัััะพะนะบะฐ ัะตัะฒะตัะฐ
make deploy           # ะะตะฟะปะพะน ะฝะฐ ะฟัะพะดะฐะบัะฝ
make status           # ะัะพะฒะตัะบะฐ ััะฐัััะฐ
make logs-server      # ะัะพัะผะพัั ะปะพะณะพะฒ
make logs-server-follow  # ะะพะณะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
make restart-server   # ะะตัะตะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
make info            # ะะฝัะพัะผะฐัะธั ะพ ะฟัะพะตะบัะต
```

### 4. Docker ะบะพะฝัะธะณััะฐัะธั

**ะคะฐะนะป:** `deployment/docker-compose.prod.yml`

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตะทะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะพะฒ
- Health checks
- ะะณัะฐะฝะธัะตะฝะธั ัะตััััะพะฒ (CPU: 1 core, Memory: 512M)
- ะะพัะฐัะธั ะปะพะณะพะฒ (10MB, 5 ัะฐะนะปะพะฒ)

### 5. ะะพะบัะผะตะฝัะฐัะธั

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `DEPLOYMENT.md` | ะะพะปะฝะฐั ะธะฝััััะบัะธั ะฟะพ ะดะตะฟะปะพั ะธ CI/CD (450+ ัััะพะบ) |
| `DEPLOYMENT_QUICKSTART.md` | ะัััััะน ััะฐัั ะทะฐ 5 ะผะธะฝัั |
| `README.md` | ะะฑะฝะพะฒะปะตะฝ ั ะธะฝัะพัะผะฐัะธะตะน ะพ ะดะตะฟะปะพะต |
| `CHANGELOG.md` | ะะตััะธั 2.2.0 ั ะดะตะฟะปะพะตะผ |

---

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### ะะตัะฒะพะฝะฐัะฐะปัะฝะฐั ะฝะฐัััะพะนะบะฐ (ะพะดะธะฝ ัะฐะท)

#### 1. ะะฐัััะพะนะบะฐ SSH

```bash
# ะกะพะทะดะฐัั SSH ะบะปัั
ssh-keygen -t rsa -b 4096

# ะกะบะพะฟะธัะพะฒะฐัั ะฝะฐ ัะตัะฒะตั
ssh-copy-id root@77.105.133.231

# ะัะพะฒะตัะธัั ะฟะพะดะบะปััะตะฝะธะต
ssh root@77.105.133.231
```

#### 2. ะะฐัััะพะนะบะฐ ัะตัะฒะตัะฐ

```bash
# ะะฒัะพะผะฐัะธัะตัะบะฐั ัััะฐะฝะพะฒะบะฐ Docker ะธ Docker Compose
make setup-server
```

#### 3. ะะฐัััะพะนะบะฐ GitHub Secrets

ะะตัะตะนัะธ: `GitHub Repo โ Settings โ Secrets and variables โ Actions`

ะะพะฑะฐะฒะธัั ัะตะบัะตัั:

| Secret | ะะฝะฐัะตะฝะธะต |
|--------|----------|
| `SSH_PRIVATE_KEY` | ะกะพะดะตัะถะธะผะพะต `~/.ssh/id_rsa` |
| `SERVER_HOST` | `77.105.133.231` |
| `SERVER_USER` | `root` |
| `API_URL` | `https://regulation.gov.ru/api/...` |
| `KEYWORDS` | `ััะฐะฝัะฟะพัั,ะบะพะฝัะตััะธะธ,ะทะฐะบัะฟะบะธ` |
| `TELEGRAM_BOT_TOKEN` | ะขะพะบะตะฝ ะพั BotFather |
| `TELEGRAM_CHAT_ID` | ID ัะฐัะฐ |
| `CRON_SCHEDULE` | `0 9 * * *` |

### ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน ัะตัะตะท GitHub

```bash
# 1. ะะฝะตัะธัะต ะธะทะผะตะฝะตะฝะธั ะฒ ะบะพะด
git add .
git commit -m "ะะฐัะธ ะธะทะผะตะฝะตะฝะธั"

# 2. Push ะฒ GitHub
git push origin main

# 3. GitHub Actions ะฐะฒัะพะผะฐัะธัะตัะบะธ:
#    - ะะฐะฟัััะธั ัะตััั
#    - ะกะพะฑะตัะตั ะฟัะธะปะพะถะตะฝะธะต
#    - ะะฐะดะตะฟะปะพะธั ะฝะฐ ัะตัะฒะตั 77.105.133.231
#    - ะะตัะตะทะฐะฟัััะธั ะบะพะฝัะตะนะฝะตัั
```

**ะัะพะฒะตัะบะฐ:**
- GitHub โ Actions โ "Deploy to Production"

### ะััะฝะพะน ะดะตะฟะปะพะน

```bash
# ะฃะฑะตะดะธัะตัั ััะพ .env ะฝะฐัััะพะตะฝ
make check-env

# ะะตะฟะปะพะน
make deploy

# ะัะพะฒะตัะบะฐ
make status

# ะะพะณะธ
make logs-server
```

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ

```bash
# ะงะตัะตะท Makefile
make status

# ะัะฒะพะด:
# ๐ณ ะกัะฐััั Docker ะบะพะฝัะตะนะฝะตัะพะฒ
# ๐พ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะธัะบะฐ
# ๐ ะะฐะทะผะตั ะดะธัะตะบัะพัะธะธ
# ๐ ะะพัะปะตะดะฝะธะต ะปะพะณะธ
```

### ะัะพัะผะพัั ะปะพะณะพะฒ

```bash
# ะะพัะปะตะดะฝะธะต 100 ัััะพะบ
make logs-server

# ะ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
make logs-server-follow

# ะะฐ ัะตัะฒะตัะต
ssh root@77.105.133.231 'cd /opt/law_scraper && docker-compose logs -f'
```

### ะฃะฟัะฐะฒะปะตะฝะธะต

```bash
# ะะตัะตะทะฐะฟััะบ
make restart-server

# ะััะฐะฝะพะฒะบะฐ (ะฝะฐ ัะตัะฒะตัะต)
ssh root@77.105.133.231 'cd /opt/law_scraper && docker-compose down'

# ะะฐะฟััะบ (ะฝะฐ ัะตัะฒะตัะต)
ssh root@77.105.133.231 'cd /opt/law_scraper && docker-compose up -d'
```

---

## ๐๏ธ ะััะธัะตะบัััะฐ ะดะตะฟะปะพั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ                    โ
โ                                                      โ
โ  git push origin main                               โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              GitHub Actions                          โ
โ                                                      โ
โ  1. Run tests                                       โ
โ  2. Build application                               โ
โ  3. SSH to server                                   โ
โ  4. Copy files                                      โ
โ  5. Docker Compose up                               โ
โ  6. Verify deployment                               โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ะกะตัะฒะตั 77.105.133.231                       โ
โ         /opt/law_scraper                            โ
โ                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ  Docker Container                  โ            โ
โ  โ  law-scraper-cron                 โ            โ
โ  โ                                    โ            โ
โ  โ  โข Cron scheduler                 โ            โ
โ  โ  โข Telegram bot                   โ            โ
โ  โ  โข RSS scanner                    โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ                                                      โ
โ  data/                                              โ
โ  โโโ keywords.json  โ ัะฟัะฐะฒะปัะตััั ัะตัะตะท Telegram   โ
โ  โโโ rss.json                                       โ
โ  โโโ matched/                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะัะพัะตัั CI/CD

1. **ะะฐะทัะฐะฑะพััะธะบ** ะดะตะปะฐะตั `git push origin main`
2. **GitHub Actions** ะทะฐะฟััะบะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
3. **ะขะตััั** ะฒัะฟะพะปะฝััััั (`go test ./...`)
4. **ะกะฑะพัะบะฐ** ะฟัะธะปะพะถะตะฝะธั (`go build`)
5. **SSH ะฟะพะดะบะปััะตะฝะธะต** ะบ ัะตัะฒะตัั 77.105.133.231
6. **ะะพะฟะธัะพะฒะฐะฝะธะต ัะฐะนะปะพะฒ** ะฝะฐ ัะตัะฒะตั
7. **Docker Compose** ะฟะตัะตัะพะทะดะฐะตั ะบะพะฝัะตะนะฝะตัั
8. **ะัะพะฒะตัะบะฐ** ััะฟะตัะฝะพััะธ ะดะตะฟะปะพั
9. **ะฃะฒะตะดะพะผะปะตะฝะธะต** ะพ ัะตะทัะปััะฐัะต

**ะัะตะผั ะดะตะฟะปะพั:** ~2-3 ะผะธะฝััั

---

## ๐ ะกัััะบัััะฐ ะฝะฐ ัะตัะฒะตัะต

```
/opt/law_scraper/
โโโ .env                     # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
โโโ docker-compose.yml       # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ Dockerfile              
โโโ scraper/                # ะััะพะดะฝัะน ะบะพะด
โ   โโโ cmd/
โ   โ   โโโ cron/main.go   # ะะฐะฟััะบะฐะตััั ะฒ ะบะพะฝัะตะนะฝะตัะต
โ   โโโ internal/
โโโ data/                   # ะะพััะพัะฝะฝัะต ะดะฐะฝะฝัะต
โ   โโโ keywords.json       # ะฃะฟัะฐะฒะปัะตััั Telegram ะฑะพัะพะผ
โ   โโโ rss.json
โ   โโโ matched/
โ       โโโ file_urls.json
โ       โโโ file_urls.txt
โโโ bin/
    โโโ cron               # ะกะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะน ะฑะธะฝะฐัะฝะธะบ
```

---

## ๐๏ธ ะะพะผะฐะฝะดั ะดะปั ัะฟัะฐะฒะปะตะฝะธั

### ะะพะบะฐะปัะฝะพ

```bash
# ะะฝัะพัะผะฐัะธั ะพ ะฟัะพะตะบัะต
make info

# ะัะพะฒะตัะบะฐ .env
make check-env

# ะะตะฟะปะพะน
make deploy

# ะกัะฐััั
make status

# ะะพะณะธ
make logs-server
make logs-server-follow

# ะะตัะตะทะฐะฟััะบ
make restart-server
```

### ะะฐ ัะตัะฒะตัะต

```bash
# ะะพะดะบะปััะตะฝะธะต
ssh root@77.105.133.231

# ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั
cd /opt/law_scraper

# ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps

# ะะพะณะธ
docker-compose logs -f

# ะะตัะตะทะฐะฟััะบ
docker-compose restart

# ะััะฐะฝะพะฒะบะฐ
docker-compose down

# ะะฐะฟััะบ
docker-compose up -d

# ะะตัะตัะฑะพัะบะฐ
docker-compose up -d --build
```

---

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะะตะฟะปะพะน ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# 1. ะัะพะฒะตัััะต GitHub Secrets
# Settings โ Secrets โ Actions

# 2. ะัะพะฒะตัััะต workflow
cat .github/workflows/deploy.yml

# 3. ะัะพะฒะตัััะต ะปะพะณะธ ะฒ GitHub Actions
```

### ะะพะฝัะตะนะฝะตั ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัััะต ะปะพะณะธ
make logs-server

# ะะฐ ัะตัะฒะตัะต
ssh root@77.105.133.231 'cd /opt/law_scraper && docker-compose logs'

# ะะตัะตัะพะทะดะฐะนัะต ะบะพะฝัะตะนะฝะตัั
ssh root@77.105.133.231 'cd /opt/law_scraper && docker-compose up -d --build'
```

### SSH ะฝะต ะฟะพะดะบะปััะฐะตััั

```bash
# ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั
ping 77.105.133.231

# ะัะพะฒะตัััะต SSH ะบะปัั
ssh -v root@77.105.133.231

# ะะตัะตัะพะทะดะฐะนัะต SSH ะบะปัั
ssh-keygen -t rsa -b 4096
ssh-copy-id root@77.105.133.231
```

---

## ๐ ะัะตะธะผััะตััะฒะฐ

โ **ะะฒัะพะผะฐัะธะทะฐัะธั** - ะดะตะฟะปะพะน ะฟัะธ ะบะฐะถะดะพะผ push  
โ **ะะตะทะพะฟะฐัะฝะพััั** - ัะตะบัะตัั ััะฐะฝัััั ะฒ GitHub  
โ **ะะฐะดะตะถะฝะพััั** - ัะตััั ะฟะตัะตะด ะดะตะฟะปะพะตะผ  
โ **ะะพะฝะธัะพัะธะฝะณ** - ะปะพะณะธ ะธ ััะฐััั ะฒ ะพะดะธะฝ ะบะปะธะบ  
โ **ะัะบะฐั** - ะปะตะณะบะพ ะพัะบะฐัะธัััั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ  
โ **ะะฐัััะฐะฑะธััะตะผะพััั** - ะปะตะณะบะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ัะตัะฒะตัะฐ  

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- **ะะพะปะฝะฐั ะธะฝััััะบัะธั:** [DEPLOYMENT.md](DEPLOYMENT.md)
- **ะัััััะน ััะฐัั:** [DEPLOYMENT_QUICKSTART.md](DEPLOYMENT_QUICKSTART.md)
- **ะัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั:** [README.md](README.md)
- **Changelog:** [CHANGELOG.md](CHANGELOG.md)

---

## ๐ ะัะพะณ

**ะขะตะฟะตัั ั ะฒะฐั:**
1. โ ะะฐัััะพะตะฝ CI/CD ัะตัะตะท GitHub Actions
2. โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน ะฟัะธ push ะฒ main
3. โ ะัะธะปะพะถะตะฝะธะต ัะฐะฑะพัะฐะตั ะฝะฐ 77.105.133.231
4. โ ะฃะดะพะฑะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท Makefile
5. โ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธ ะฒ ะพะดะธะฝ ะบะปะธะบ
6. โ ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

**ะัะฟะพะปัะทัะนัะต:**
```bash
# ะะตะฟะปะพะน
git push origin main

# ะัะพะฒะตัะบะฐ
make status

# ะะพะณะธ
make logs-server
```

**๐ ะะพัะพะฒะพ ะบ ะฟัะพะดะฐะบัะตะฝั!**

