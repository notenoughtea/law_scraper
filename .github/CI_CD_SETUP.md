# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–ø–ª–æ—è –ø—Ä–∏ –∫–æ–º–º–∏—Ç–∞—Ö.

### üîÑ Workflow —Ñ–∞–π–ª—ã

1. **`ci.yml`** - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
   - –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

2. **`deploy.yml`** - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–æ–º–º–∏—Ç–∞—Ö –≤ `main`/`master`
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ç–µ—Å—Ç ‚Üí —Å–±–æ—Ä–∫–∞ ‚Üí –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `Settings` ‚Üí `Secrets and variables` ‚Üí `Actions`

### üîë –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:

#### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**

| Secret | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `SSH_PRIVATE_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É | `-----BEGIN RSA PRIVATE KEY-----...` |
| `SERVER_HOST` | IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ | `77.105.133.231` |
| `SERVER_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | `root` |
| `API_URL` | URL API –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ | `https://regulation.gov.ru/api/public/` |
| `KEYWORDS` | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | `—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç,–∑–∞–∫—É–ø–∫–∏,–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ` |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | `123456789:ABCdefGHIjklMNOpqrsTUVwxyz` |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | `-1001234567890` |

#### **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**

| Secret | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|--------|----------|----------------------|
| `CRON_SCHEDULE` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ | `0 9 * * *` (9:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å) |
| `MAX_WORKERS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ | `3` |

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 1. –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
```bash
ssh-keygen -t rsa -b 4096 -C "github-actions"
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –≤ ~/.ssh/github_actions
```

### 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
ssh-copy-id -i ~/.ssh/github_actions.pub root@77.105.133.231
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
cat ~/.ssh/github_actions.pub | ssh root@77.105.133.231 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### 3. –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á

```bash
cat ~/.ssh/github_actions
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** –≤—ã–≤–æ–¥ (–≤–∫–ª—é—á–∞—è `-----BEGIN` –∏ `-----END`)

### 4. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ GitHub
2. `Settings` ‚Üí `Secrets and variables` ‚Üí `Actions`
3. `New repository secret`
4. –î–æ–±–∞–≤—å—Ç–µ –∫–∞–∂–¥—ã–π —Å–µ–∫—Ä–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ

---

## üéØ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ

### –ü—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ `main`/`master`:

```
1. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
2. üî® –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
3. üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. üê≥ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
5. üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```

### –ü—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ –¥—Ä—É–≥–∏–µ –≤–µ—Ç–∫–∏:

```
1. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
2. üî® –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å workflow

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- `Actions` ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow run
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
```bash
ssh root@77.105.133.231
cd /opt/law_scraper
docker-compose ps
docker-compose logs --tail=50
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –±–æ—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É:
```
/help
```

–ï—Å–ª–∏ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## üõ†Ô∏è –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ `Actions` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow `Deploy to Production`
3. –ù–∞–∂–º–∏—Ç–µ `Run workflow`
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É (`main` –∏–ª–∏ `master`)
5. –ù–∞–∂–º–∏—Ç–µ `Run workflow`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í –ª–æ–≥–∞—Ö GitHub Actions –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
‚úÖ Test - –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
üî® Build - –ë–∏–Ω–∞—Ä–Ω–∏–∫–∏ —Å–æ–±—Ä–∞–Ω—ã
üì¶ Copy files - –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
üê≥ Deploy - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã
‚úÖ Verify - –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω
```

### –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:

```
‚ùå Deployment failed!
üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Permission denied (publickey)"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `SSH_PRIVATE_KEY` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `-----BEGIN RSA PRIVATE KEY-----`)

### –û—à–∏–±–∫–∞: "Connection refused"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SERVER_HOST` –∏ `SERVER_USER`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: `ping 77.105.133.231`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø: `ssh root@77.105.133.231`

### –û—à–∏–±–∫–∞: "docker-compose: command not found"

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
sudo apt update
sudo apt install docker-compose -y
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã (–æ—Å–æ–±–µ–Ω–Ω–æ `scraper/go.mod` –∏ `scraper/go.sum`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –≤ Go —Ñ–∞–π–ª–∞—Ö

---

## üìà –£–ª—É—á—à–µ–Ω–∏—è

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:**
   - –î–æ–±–∞–≤—å—Ç–µ webhook –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –¥–µ–ø–ª–æ—è

2. **–û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–µ–ø–ª–æ—è

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging:**
   - –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤, –∫–∞–∂–¥—ã–π –∫–æ–º–º–∏—Ç –≤ `main`/`master` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç—ã - –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–¥–µ–ª–∞–µ—Ç CI/CD! üöÄ**

